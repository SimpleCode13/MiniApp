<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Run Poizon ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä + –∏–≥—Ä—ã</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{
  --tg-bg:#f4f6f9;
  --tg-fg:#222;
  --tg-accent:#0088cc;
  --card-bg:#fff;
  --border:#e5e7eb;
  --shadow:0 6px 20px rgba(0,0,0,0.1);
}
@media(prefers-color-scheme: dark){
  :root{
    --tg-bg:#0f1115;
    --tg-fg:#e8e8e8;
    --tg-accent:#2ea6ff;
    --card-bg:#171a21;
    --border:#2a2f3a;
    --shadow:0 8px 24px rgba(0,0,0,0.35);
  }
}
body{font-family:-apple-system, system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans"; background:var(--tg-bg); color:var(--tg-fg); margin:0; padding:16px 16px 90px; display:flex; justify-content:center;}
.wrap{width:100%; max-width:420px;}
.card{background:var(--card-bg); border-radius:16px; padding:22px; box-shadow:var(--shadow); text-align:center;}
.logo-title{display:flex; flex-direction:column; align-items:center; margin-bottom:16px;}
.logo-title img{width:48px; height:48px; border-radius:10px; margin-bottom:8px;}
.logo-title span{color:var(--tg-accent); font-weight:800; font-size:20px;}
label{display:block; margin:14px 0 6px; font-weight:600; text-align:left;}
input,select{width:100%; padding:12px; border:1px solid var(--border); border-radius:12px; background:transparent; color:var(--tg-fg); font-size:16px; box-sizing:border-box; outline:none;}
input:focus,select:focus{border-color:var(--tg-accent);}
.btn{width:100%; padding:14px; background:var(--tg-accent); border:none; color:white; font-size:16px; font-weight:700; border-radius:12px; cursor:pointer; margin-top:14px;}
.muted{opacity:.8; font-size:13px; margin-top:8px; text-align:left;}
#result{margin-top:16px; font-size:18px; font-weight:700; white-space:pre-line; text-align:left;}

/* –ù–∏–∂–Ω—è—è –∫–Ω–æ–ø–∫–∞ "–ò–≥—Ä–∞—Ç—å" */
.playbar{position:fixed; left:0; right:0; bottom:0; padding:12px 16px calc(env(safe-area-inset-bottom)+12px); background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.06) 10%), var(--tg-bg); display:flex; justify-content:center; border-top:1px solid var(--border); z-index:10;}
.playbar .play-btn{max-width:420px; width:calc(100%-32px); background:var(--tg-accent); color:#fff; border:none; border-radius:14px; padding:16px; font-size:17px; font-weight:800; box-shadow:var(--shadow);}

/* Overlay –∏ –∏–≥—Ä—ã */
.overlay{position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:50; backdrop-filter:blur(2px);}
.overlay.show{display:flex;}
.game-card{width:96vw; max-width:480px; background:var(--card-bg); border-radius:18px; box-shadow:var(--shadow); padding:12px 12px 18px; display:flex; flex-direction:column; align-items:center;}
.game-header{display:flex; align-items:center; justify-content:space-between; padding:4px 6px 10px; width:100%;}
.game-title{font-weight:800;}
.close-btn{border:1px solid var(--border); background:transparent; color:var(--tg-fg); padding:6px 10px; border-radius:10px; font-weight:700; cursor:pointer;}

/* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –∏–≥—Ä—ã (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Å—Ç–∏–ª—å) */
.game-choice-btn{width:90%; height:50px; font-size:18px; font-weight:800; margin:10px 0; border-radius:14px; cursor:pointer; transition:0.2s; border:none; background:var(--tg-accent); color:#fff;}
.game-choice-btn:hover{transform:scale(1.05);}

/* Miner */
#minerGrid{display:grid; grid-template-columns:repeat(5,60px); grid-gap:8px; margin-top:12px;}
.cell{width:60px; height:60px; background:#444; border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition: transform 0.2s; position:relative;}
.cell:hover{transform:scale(1.05);}
.cell img{width:50px; height:50px; display:none;}
.cell.explode img{display:block; animation:explode 0.6s forwards;}
.cell.win img{display:block;}
@keyframes explode{0%{transform:scale(1); opacity:1;}50%{transform:scale(2); opacity:0.7; filter:hue-rotate(0deg);}70%{transform:scale(2.5); filter:hue-rotate(180deg);}100%{transform:scale(0); opacity:0; filter:hue-rotate(360deg);}}
#minerMsg{margin-top:10px; font-weight:700;}
.restart-btn{margin-top:10px; padding:8px 12px; border:none; border-radius:10px; background:var(--tg-accent); color:#fff; font-weight:700; cursor:pointer;}

/* Run Poizon */
#runCanvas{width:100%; height:260px; border:1px solid var(--border); border-radius:14px; background:linear-gradient(#bde0ff,#eaf3ff); display:none;}
.score{font-weight:800; margin-top:8px; text-align:center;}
.game-cta{display:flex; gap:8px; margin-top:10px;}
.game-cta button{flex:1; padding:12px; border-radius:12px; border:none; font-weight:800; cursor:pointer;}
.primary{background:var(--tg-accent); color:#fff;}
.secondary{background:transparent; border:1px solid var(--border); color:var(--tg-fg);}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="logo-title">
      <img src="poizon.png" alt="Poizon logo">
      <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
    </div>
    <label for="price">–¶–µ–Ω–∞ –≤ —é–∞–Ω—è—Ö</label>
    <input type="number" id="price" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 500" inputmode="decimal"/>
    <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
    <select id="category">
      <option value="–§—É—Ç–±–æ–ª–∫–∞ / –º–∞–π–∫–∞ / —Ä—É–±–∞—à–∫–∞">–§—É—Ç–±–æ–ª–∫–∞ / –º–∞–π–∫–∞ / —Ä—É–±–∞—à–∫–∞</option>
      <option value="–ë—Ä—é–∫–∏ / –¥–∂–∏–Ω—Å—ã">–ë—Ä—é–∫–∏ / –¥–∂–∏–Ω—Å—ã</option>
      <option value="–•—É–¥–∏ / —Ç–æ–ª—Å—Ç–æ–≤–∫–∞ / —Å–≤–∏—Ç—à–æ—Ç">–•—É–¥–∏ / —Ç–æ–ª—Å—Ç–æ–≤–∫–∞ / —Å–≤–∏—Ç—à–æ—Ç</option>
      <option value="–°—É–º–∫–∞ / —Ä—é–∫–∑–∞–∫">–°—É–º–∫–∞ / —Ä—é–∫–∑–∞–∫</option>
      <option value="–ü–æ—è—Å–Ω–∞—è —Å—É–º–∫–∞">–ü–æ—è—Å–Ω–∞—è —Å—É–º–∫–∞</option>
      <option value="–®–∞–ø–∫–∞/ —à–∞—Ä—Ñ / –Ω–æ—Å–∫–∏">–®–∞–ø–∫–∞/ —à–∞—Ä—Ñ / –Ω–æ—Å–∫–∏</option>
      <option value="–í–µ—Ç—Ä–æ–≤–∫–∞ / –∫—É—Ä—Ç–∫–∞">–í–µ—Ç—Ä–æ–≤–∫–∞ / –∫—É—Ä—Ç–∫–∞</option>
      <option value="–ö—Ä–æ—Å—Å–æ–≤–∫–∏ / –∫–µ–¥—ã / –±–æ—Ç–∏–Ω–∫–∏">–ö—Ä–æ—Å—Å–æ–≤–∫–∏ / –∫–µ–¥—ã / –±–æ—Ç–∏–Ω–∫–∏</option>
      <option value="–ó–∏–º–Ω—è—è –æ–±—É–≤—å">–ó–∏–º–Ω—è—è –æ–±—É–≤—å</option>
    </select>
    <button class="btn" id="calcBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    <div id="result"></div>
    <div class="muted">–ü–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ —á–∞—Ç –±–æ—Ç–∞.</div>
  </div>
</div>

<div class="playbar">
  <button class="play-btn" id="openGame">üéÆ –ò–≥—Ä–∞—Ç—å</button>
</div>

<div class="overlay" id="overlay">
  <!-- –í—ã–±–æ—Ä –∏–≥—Ä—ã -->
  <div class="game-card" id="gameSelectCard">
    <div class="game-header">
      <div class="game-title">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</div>
      <button class="close-btn" id="closeGame">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <button class="game-choice-btn" id="selectMiner">Poizon Miner</button>
    <button class="game-choice-btn" id="selectRun">Run Poizon</button>
  </div>

  <!-- Miner -->
  <div class="game-card" id="minerCard" style="display:none;">
    <div class="game-header">
      <div class="game-title">üí£ Poizon Miner</div>
      <button class="close-btn" id="closeMiner">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <label for="numMines">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω (1‚Äì10):</label>
    <input type="number" id="numMines" min="1" max="10" value="3"/>
    <div id="minerGrid"></div>
    <div id="minerMsg"></div>
    <button class="restart-btn" id="restartGame">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  </div>

  <!-- Run Poizon -->
  <div class="game-card" id="runCard" style="display:none;">
    <div class="game-header">
      <div class="game-title">üèÉ‚Äç‚ôÇÔ∏è Run Poizon</div>
      <button class="close-btn" id="closeRun">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <canvas id="runCanvas" width="480" height="260"></canvas>
    <div class="score" id="runScore"></div>
    <div class="game-cta">
      <button class="secondary" id="tapBtn">–ü—Ä—ã–∂–æ–∫</button>
      <button class="primary" id="restartRunBtn">–°—Ç–∞—Ä—Ç/–†–µ—Å—Ç–∞—Ä—Ç</button>
    </div>
  </div>
</div>

<script>
// ====== Calculator ======
const formulas={
"–§—É—Ç–±–æ–ª–∫–∞ / –º–∞–π–∫–∞ / —Ä—É–±–∞—à–∫–∞":x=>(x+(x>1526?x*0.15:0))*12+772.31+1000,
"–ë—Ä—é–∫–∏ / –¥–∂–∏–Ω—Å—ã":x=>(x+(x>1526?x*0.15:0))*12+1019.91+1000,
"–•—É–¥–∏ / —Ç–æ–ª—Å—Ç–æ–≤–∫–∞ / —Å–≤–∏—Ç—à–æ—Ç":x=>(x+(x>1526?x*0.15:0))*12+1081.81+1000,
"–°—É–º–∫–∞ / —Ä—é–∫–∑–∞–∫":x=>(x+(x>1526?x*0.15:0))*12+1453.21+1000,
"–ü–æ—è—Å–Ω–∞—è —Å—É–º–∫–∞":x=>(x+(x>1526?x*0.15:0))*12+772.31+1000,
"–®–∞–ø–∫–∞/ —à–∞—Ä—Ñ / –Ω–æ—Å–∫–∏":x=>(x+(x>1526?x*0.15:0))*12+772.31+1000,
"–í–µ—Ç—Ä–æ–≤–∫–∞ / –∫—É—Ä—Ç–∫–∞":x=>(x+(x>1526?x*0.15:0))*12+1453.21+1000,
"–ö—Ä–æ—Å—Å–æ–≤–∫–∏ / –∫–µ–¥—ã / –±–æ—Ç–∏–Ω–∫–∏":x=>(x+(x>1526?x*0.15:0))*12+1733.59+1000,
"–ó–∏–º–Ω—è—è –æ–±—É–≤—å":x=>(x+(x>1526?x*0.15:0))*12+2104.99+1000
};
const priceEl=document.getElementById('price');
const categoryEl=document.getElementById('category');
const resultEl=document.getElementById('result');
document.getElementById('calcBtn').addEventListener('click',()=>{
  const price=parseFloat(priceEl.value);
  const category=categoryEl.value;
  if(isNaN(price)){resultEl.textContent="‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É!"; return;}
  const result=formulas[category](price);
  resultEl.textContent=`–ö –æ–ø–ª–∞—Ç–µ: ${result.toFixed(2)} ‚ÇΩ\nüì¶ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category}`;
  try{Telegram.WebApp.sendData(JSON.stringify({price,category,result}));}catch(e){}
});

// ====== Overlay & Game Selection ======
const overlay=document.getElementById('overlay');
const openGameBtn=document.getElementById('openGame');
const closeGameBtn=document.getElementById('closeGame');
const gameSelectCard=document.getElementById('gameSelectCard');
const minerCard=document.getElementById('minerCard');
const runCard=document.getElementById('runCard');
openGameBtn.onclick=()=>overlay.classList.add('show');
closeGameBtn.onclick=()=>overlay.classList.remove('show');

document.getElementById('selectMiner').onclick=()=>{
  gameSelectCard.style.display='none';
  minerCard.style.display='flex';
  startMinerGame();
};
document.getElementById('selectRun').onclick=()=>{
  gameSelectCard.style.display='none';
  runCard.style.display='flex';
  startRunGame();
};

// ====== Miner Poizon ======
const minerGridEl=document.getElementById('minerGrid');
const minerMsg=document.getElementById('minerMsg');
const restartMinerBtn=document.getElementById('restartGame');
document.getElementById('closeMiner').onclick=()=>{
  minerCard.style.display='none';
  gameSelectCard.style.display='flex';
}

function startMinerGame(){
  const numMinesEl=document.getElementById('numMines');
  const gridSize=5;
  let cells=[], mines=[], gameOver=false;

  function createGrid(){
    minerGridEl.innerHTML='';
    cells=[];
    mines=[];
    minerMsg.textContent='';
    gameOver=false;
    const mineCount=Math.min(Math.max(parseInt(numMinesEl.value)||3,1),10);
    while(mines.length<mineCount){
      const idx=Math.floor(Math.random()*gridSize*gridSize);
      if(!mines.includes(idx)) mines.push(idx);
    }
    for(let i=0;i<gridSize*gridSize;i++){
      const div=document.createElement('div');
      div.classList.add('cell');
      const img=document.createElement('img');
      img.src='mina.png';
      div.appendChild(img);
      div.onclick=()=>{
        if(gameOver) return;
        if(mines.includes(i)){
          div.classList.add('explode');
          gameOver=true;
          revealMines();
          minerMsg.textContent='üí• –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!';
        } else {
          div.style.background='#2e7d32';
          checkWin();
        }
      }
      minerGridEl.appendChild(div);
      cells.push(div);
    }
  }

  function revealMines(){
    cells.forEach((c,i)=>{
      if(mines.includes(i)) c.querySelector('img').style.display='block';
    });
  }

  function checkWin(){
    if(cells.filter(c=>c.style.background!=='rgb(46, 125, 50)').length===mines.length){
      gameOver=true;
      minerMsg.textContent='üèÜ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!';
      revealMines();
    }
  }

  createGrid();
  restartMinerBtn.onclick=createGrid;
}

// ====== Run Poizon —Å –æ–±–ª–∞–∫–∞–º–∏ ======
const runCanvas=document.getElementById('runCanvas');
const runCtx=runCanvas.getContext('2d');
const runScoreEl=document.getElementById('runScore');
let runGroundY=runCanvas.height-40;
let dino={x:30,y:runGroundY-40,w:60,h:40,vy:0,onGround:true};
let obstacles=[],speed=4,gravity=0.7,score=0,high=parseInt(localStorage.getItem('dino_high')||'0'),playing=false,lastSpawn=0,anim,prev=0;

// –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
const boxImg=new Image(); boxImg.src='sticker.png';
const cloudImg=new Image(); cloudImg.src='cloud.png';

// –û–±–ª–∞–∫–∞
let clouds=[];
const cloudSpawnChance=0.005; // —à–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–∞–¥—Ä

function setRunScore(){ runScoreEl.textContent=`–°—á—ë—Ç: ${Math.floor(score)} ‚Ä¢ –†–µ–∫–æ—Ä–¥: ${Math.floor(high)}`; }
function resetRun(){ obstacles=[]; speed=4; score=0; dino.y=runGroundY-dino.h; dino.vy=0; dino.onGround=true; lastSpawn=0; clouds=[]; runCanvas.style.display='block'; }

function spawnObstacle(){ const h=25+Math.random()*30; const branches=1+Math.floor(Math.random()*2); obstacles.push({x:runCanvas.width+10,y:runGroundY,h,branches}); }
function drawCactus(o){ runCtx.fillStyle="#2e7d32"; runCtx.fillRect(o.x,o.y-o.h,12,o.h); if(o.branches>0){ runCtx.fillRect(o.x-10,o.y-o.h/2,10,20); runCtx.fillRect(o.x+12,o.y-o.h/1.5,10,25);} }
function jumpRun(){ if(dino.onGround){dino.vy=-11.5; dino.onGround=false;} }

function updateRun(dt){
  dino.vy+=gravity; dino.y+=dino.vy;
  if(dino.y>=runGroundY-dino.h){dino.y=runGroundY-dino.h; dino.vy=0; dino.onGround=true;}

  obstacles.forEach(o=>o.x-=speed);
  obstacles=obstacles.filter(o=>o.x+30>-10);
  lastSpawn+=dt;
  if(lastSpawn>Math.max(1300-speed*40,600)){spawnObstacle(); lastSpawn=0;}
  speed+=0.0015*dt/16.7;
  score+=0.02*speed*dt/16.7;

  for(let o of obstacles){
    if(dino.x<o.x+12 && dino.x+dino.w>o.x && dino.y<o.y && dino.y+dino.h>o.y-o.h) gameOverRun();
  }

  // –û–±–ª–∞–∫–∞
  if(Math.random()<cloudSpawnChance){
    clouds.push({
      x: runCanvas.width,
      y: 10+Math.random()*100,
      w: 40+Math.random()*60,
      h: 20+Math.random()*30,
      speed: 0.5+Math.random()*1.5,
      alpha: 0.3+Math.random()*0.4
    });
  }
  clouds.forEach(c=>c.x-=c.speed*dt/16.7);
  clouds=clouds.filter(c=>c.x+c.w>0);
}

function drawRun(){
  runCtx.clearRect(0,0,runCanvas.width,runCanvas.height);

  // –†–∏—Å—É–µ–º –æ–±–ª–∞–∫–∞
  clouds.forEach(c=>{
    runCtx.globalAlpha=c.alpha;
    runCtx.drawImage(cloudImg,c.x,c.y,c.w,c.h);
  });
  runCtx.globalAlpha=1;

  runCtx.fillStyle='#3b3b3b';
  runCtx.fillRect(0,runGroundY+2,runCanvas.width,2);

  runCtx.drawImage(boxImg,dino.x,dino.y,dino.w,dino.h);
  obstacles.forEach(o=>drawCactus(o));

  runCtx.fillStyle='#111';
  runCtx.font='bold 16px system-ui, sans-serif';
  runCtx.fillText('–°—á—ë—Ç: '+Math.floor(score),10,22);
}

function loopRun(ts){
  if(!playing) return;
  const dt=prev?(ts-prev):16.7;
  prev=ts;
  updateRun(dt);
  drawRun();
  anim=requestAnimationFrame(loopRun);
}

function startRunGame(){ resetRun(); playing=true; prev=0; cancelAnimationFrame(anim); loopRun(0); setRunScore(); }
function gameOverRun(){ playing=false; cancelAnimationFrame(anim); if(score>high){high=score; localStorage.setItem('dino_high',String(Math.floor(high)));} setRunScore(); }

document.getElementById('restartRunBtn').onclick=startRunGame;
document.getElementById('tapBtn').onclick=jumpRun;
document.getElementById('closeRun').onclick=()=>{ runCard.style.display='none'; gameSelectCard.style.display='flex'; }
window.addEventListener('keydown', e=>{ if(e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); jumpRun();} if(e.code==='Enter') startRunGame(); if(e.code==='Escape') overlay.classList.remove('show'); });
runCanvas.addEventListener('touchstart', e=>{ e.preventDefault(); jumpRun();},{passive:false});
</script>
</body>
</html>
